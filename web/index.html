<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Dungeon - 강화학습 던전</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>RL Dungeon</h1>
            <p class="subtitle">강화학습 던전 탐험</p>
        </header>

        <nav class="mode-tabs">
            <button class="mode-tab active" data-mode="play">Play</button>
            <button class="mode-tab" data-mode="editor">Editor</button>
        </nav>

        <main>
            <div class="game-area">
                <canvas id="game-canvas"></canvas>

                <div class="dpad-container" id="dpad-container">
                    <div class="dpad">
                        <button class="dpad-btn dpad-up" data-action="0">&#9650;</button>
                        <button class="dpad-btn dpad-left" data-action="2">&#9664;</button>
                        <button class="dpad-btn dpad-center"></button>
                        <button class="dpad-btn dpad-right" data-action="3">&#9654;</button>
                        <button class="dpad-btn dpad-down" data-action="1">&#9660;</button>
                    </div>
                </div>

                <div class="game-ui">
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-label">Gold</span>
                            <span class="stat-value gold-value" id="gold-text">100</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">HP</span>
                            <div class="hp-bar">
                                <div class="hp-fill" id="hp-fill"></div>
                            </div>
                            <span class="stat-value" id="hp-text">100/100</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Steps</span>
                            <span class="stat-value" id="steps-text">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Reward</span>
                            <span class="stat-value" id="reward-text">0.0</span>
                        </div>
                        <div class="stat" id="clear-rate-stat" style="display:none;">
                            <span class="stat-label">Clear Rate</span>
                            <span class="stat-value" id="clear-rate-text">-</span>
                        </div>
                    </div>

                    <div class="message" id="message"></div>
                </div>
            </div>

            <div class="controls">
                <div class="control-section">
                    <h3>Character</h3>
                    <div class="character-grid">
                        <button class="char-card active" data-char="qkun">
                            <span class="char-name">Q군</span>
                            <span class="char-algo">Q-Learning</span>
                        </button>
                        <button class="char-card" data-char="scout">
                            <span class="char-name">스카우트</span>
                            <span class="char-algo">Local Q</span>
                        </button>
                        <button class="char-card" data-char="sarsa">
                            <span class="char-name">사르사</span>
                            <span class="char-algo">SARSA</span>
                        </button>
                        <button class="char-card" data-char="monte">
                            <span class="char-name">몬테</span>
                            <span class="char-algo">Monte Carlo</span>
                        </button>
                        <button class="char-card" data-char="tracer">
                            <span class="char-name">트레이서</span>
                            <span class="char-algo">SARSA(λ)</span>
                        </button>
                        <button class="char-card" data-char="dyna">
                            <span class="char-name">다이나</span>
                            <span class="char-algo">Dyna-Q</span>
                        </button>
                        <button class="char-card" data-char="gradi">
                            <span class="char-name">그래디</span>
                            <span class="char-algo">REINFORCE</span>
                        </button>
                        <button class="char-card" data-char="critic">
                            <span class="char-name">크리틱</span>
                            <span class="char-algo">Actor-Critic</span>
                        </button>
                        <button class="char-card" data-char="qvkun">
                            <span class="char-name">QV군</span>
                            <span class="char-algo">QV-Learning</span>
                        </button>
                        <button class="char-card" data-char="acla">
                            <span class="char-name">아클라</span>
                            <span class="char-algo">ACLA</span>
                        </button>
                        <button class="char-card" data-char="ensemble">
                            <span class="char-name">앙상블</span>
                            <span class="char-algo">Ensemble</span>
                        </button>
                    </div>
                    <p class="character-desc" id="character-desc">
                        좌표를 외워서 학습합니다. 던전별 전문가.
                    </p>
                </div>

                <div class="control-section">
                    <h3>Dungeon</h3>
                    <select id="dungeon-select">
                        <option value="level_01_easy">Lv.1 Tutorial</option>
                        <option value="level_02_trap">Lv.2 First Trap</option>
                        <option value="level_03_maze">Lv.3 Maze</option>
                        <option value="level_04_pit">Lv.4 Pit Danger</option>
                        <option value="level_05_gold">Lv.5 Gold Rush</option>
                        <option value="level_06_risk">Lv.6 Risk & Reward</option>
                        <option value="level_07_gauntlet">Lv.7 Gauntlet</option>
                        <option value="level_08_deadly">Lv.8 Deadly Maze</option>
                        <option value="level_09_treasure">Lv.9 Treasure Hunt</option>
                        <option value="level_10_final">Lv.10 Final</option>
                        <option value="level_11_hp_test">Lv.11 HP Test</option>
                        <option value="level_12_hp_gauntlet">Lv.12 HP Gauntlet</option>
                        <option value="level_13_cliff">Lv.13 Cliff Walk</option>
                        <option value="level_14_long_hall">Lv.14 Long Hall</option>
                        <option value="level_15_multi_room">Lv.15 Multi Room</option>
                        <option value="level_16_open_field">Lv.16 Open Field</option>
                        <option value="level_17_two_paths">Lv.17 Two Paths</option>
                        <option value="level_18_dead_end">Lv.18 Dead End Labyrinth</option>
                        <option value="level_19_bridge">Lv.19 Narrow Bridge</option>
                        <option value="level_20_sacrifice">Lv.20 Cliff Walking</option>
                        <option value="level_21_desert">Lv.21 Desert Crossing</option>
                        <option value="level_22_arena">Lv.22 Monster Arena</option>
                        <option value="level_23_mirage">Lv.23 The Mirage</option>
                        <option value="level_24_paper_maze">Lv.24 Paper Maze</option>
                        <option value="level_25_paper_hard">Lv.25 Paper Maze+</option>
                    </select>
                    <button id="btn-reset">Reset (R)</button>
                </div>

                <div class="control-section">
                    <h3>AI Training</h3>
                    <div class="speed-buttons" id="speed-buttons">
                        <span class="speed-label">Speed:</span>
                        <button class="btn-speed active" data-speed="1">1x</button>
                        <button class="btn-speed" data-speed="2">2x</button>
                        <button class="btn-speed" data-speed="3">3x</button>
                        <button class="btn-speed" data-speed="0">Instant</button>
                    </div>
                    <div class="train-mode-select">
                        <span class="speed-label">Mode:</span>
                        <select id="train-mode">
                            <option value="until_success">Until Success</option>
                            <option value="continuous">Continuous</option>
                        </select>
                    </div>
                    <div class="train-buttons">
                        <button id="btn-start-train" class="btn-train">Start Training</button>
                        <button id="btn-stop-train" class="btn-stop" disabled>Stop</button>
                    </div>
                    <div class="train-progress" id="train-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">0%</div>
                    </div>
                    <div class="train-stats" id="train-stats"></div>
                </div>

                <div class="control-section">
                    <h3>Game Mode</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="fog-of-war" checked> Fog of War
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="sound-toggle" checked> Sound
                    </label>
                </div>

                <div class="control-section">
                    <h3>Visualization</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-qvalues"> Show Q-Values
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-policy"> Show Policy
                    </label>
                </div>

                <div class="control-section">
                    <h3>Controls</h3>
                    <div class="key-hints">
                        <span class="key">↑↓←→</span> Move
                    </div>
                </div>

                <div class="control-section">
                    <h3>Legend</h3>
                    <div class="legend">
                        <div class="legend-item"><span class="tile-preview start"></span> Start</div>
                        <div class="legend-item"><span class="tile-preview goal"></span> Goal (+100)</div>
                        <div class="legend-item"><span class="tile-preview trap"></span> Trap (-10 HP)</div>
                        <div class="legend-item"><span class="tile-preview heal"></span> Heal (+10 HP)</div>
                        <div class="legend-item"><span class="tile-preview pit"></span> Pit (Instant Death)</div>
                        <div class="legend-item"><span class="tile-preview gold"></span> Gold (+10)</div>
                        <div class="legend-item"><span class="tile-preview monster"></span> Monster (-30 HP)</div>
                        <div class="legend-item"><span class="tile-preview wall"></span> Wall</div>
                    </div>
                </div>
            </div>

            <div class="controls editor-controls" id="editor-controls" style="display: none;">
                <nav class="editor-subtabs">
                    <button class="editor-subtab active" data-subtab="stage">Stage</button>
                    <button class="editor-subtab" data-subtab="dungeon">Dungeon</button>
                </nav>

                <!-- ===== Stage Panel (Tile Editor) ===== -->
                <div class="editor-panel" id="stage-panel">
                    <div class="control-section">
                        <h3>Grid Size</h3>
                        <div class="size-controls">
                            <label class="size-label">W: <input type="number" id="grid-width" class="size-input" value="7" min="3" max="25"></label>
                            <label class="size-label">H: <input type="number" id="grid-height" class="size-input" value="7" min="3" max="25"></label>
                            <button class="btn-small" id="btn-apply-size">Apply</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Tile Palette</h3>
                        <div class="tile-palette" id="tile-palette">
                            <!-- Generated dynamically by JS -->
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Tools</h3>
                        <div class="tool-buttons">
                            <button class="btn-tool active" data-tool="brush">Brush</button>
                            <button class="btn-tool" data-tool="eraser">Eraser</button>
                            <button class="btn-tool" data-tool="fill">Fill</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Actions</h3>
                        <div class="action-buttons">
                            <button class="btn-small btn-action" id="btn-undo">Undo</button>
                            <button class="btn-small btn-action" id="btn-redo">Redo</button>
                            <button class="btn-small btn-action" id="btn-clear">Clear</button>
                            <button class="btn-small btn-action btn-validate" id="btn-validate">Validate</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Stage Library</h3>
                        <div class="save-controls">
                            <input type="text" id="dungeon-name-input" class="dungeon-name-input" placeholder="Stage name...">
                            <button class="btn-small btn-save" id="btn-save-dungeon">Save</button>
                        </div>
                        <div class="load-controls">
                            <select id="custom-dungeon-select">
                                <option value="">-- Select --</option>
                            </select>
                            <div class="load-buttons">
                                <button class="btn-small" id="btn-load-dungeon">Load</button>
                                <button class="btn-small btn-danger-small" id="btn-delete-dungeon">Delete</button>
                            </div>
                        </div>
                    </div>

                    <div class="control-section">
                        <button class="btn-play-dungeon" id="btn-play-dungeon">Play This Stage</button>
                    </div>

                    <div class="control-section" id="quick-test-section">
                        <h3>Quick Test</h3>
                        <div class="quick-test-char-select">
                            <span class="speed-label">Character:</span>
                            <select id="qt-character">
                                <option value="qkun">Q군 (Q-Learning)</option>
                                <option value="scout">스카우트 (Local Q)</option>
                                <option value="sarsa">사르사 (SARSA)</option>
                                <option value="monte">몬테 (Monte Carlo)</option>
                                <option value="tracer">트레이서 (SARSA(λ))</option>
                                <option value="dyna">다이나 (Dyna-Q)</option>
                                <option value="gradi">그래디 (REINFORCE)</option>
                                <option value="critic">크리틱 (Actor-Critic)</option>
                                <option value="qvkun">QV군 (QV-Learning)</option>
                                <option value="acla">아클라 (ACLA)</option>
                                <option value="ensemble">앙상블 (Ensemble)</option>
                            </select>
                        </div>
                        <div class="quick-test-episodes">
                            <span class="speed-label">Episodes:</span>
                            <select id="qt-episodes">
                                <option value="500">500</option>
                                <option value="1000" selected>1000</option>
                                <option value="3000">3000</option>
                                <option value="5000">5000</option>
                            </select>
                        </div>
                        <div class="quick-test-buttons">
                            <button class="btn-train" id="btn-quick-test">Quick Test</button>
                            <button class="btn-stop" id="btn-quick-test-stop" disabled>Stop</button>
                        </div>
                        <div class="quick-test-progress" id="qt-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="qt-progress-fill"></div>
                            </div>
                            <div class="progress-text" id="qt-progress-text"></div>
                        </div>
                        <div class="quick-test-results" id="qt-results"></div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="qt-show-policy"> Show learned policy
                        </label>
                    </div>

                    <div class="control-section">
                        <h3>Shortcuts</h3>
                        <div class="key-hints">
                            <span class="key">0-8</span> Select tile<br>
                            <span class="key">Ctrl+Z</span> Undo<br>
                            <span class="key">Ctrl+Y</span> Redo<br>
                            <span class="key">Right-click</span> Erase
                        </div>
                    </div>
                </div>

                <!-- ===== Dungeon Panel (Dungeon Composer) ===== -->
                <div class="editor-panel" id="dungeon-panel" style="display: none;">
                    <div class="control-section">
                        <h3>Dungeon Composer</h3>
                        <input type="text" id="dungeon-composer-name" class="dungeon-name-input" placeholder="Dungeon name...">
                    </div>

                    <div class="control-section">
                        <h3>Floors</h3>
                        <div id="dungeon-floor-list" class="dungeon-floor-list">
                            <!-- Dynamic floor slots -->
                        </div>
                        <button class="btn-small btn-add-floor" id="btn-add-floor">+ Add Floor</button>
                    </div>

                    <div class="control-section">
                        <h3>Rules</h3>
                        <label class="checkbox-label">
                            <input type="checkbox" id="dungeon-hp-carry" checked> HP Carry Over
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="dungeon-gold-on-clear" checked> Gold on Clear Only
                        </label>
                    </div>

                    <div class="control-section">
                        <div class="save-controls">
                            <button class="btn-small btn-save" id="btn-save-dungeon-comp" style="width:100%">Save Dungeon</button>
                        </div>
                        <div class="load-controls">
                            <select id="dungeon-comp-select">
                                <option value="">-- Select Dungeon --</option>
                            </select>
                            <div class="load-buttons">
                                <button class="btn-small" id="btn-load-dungeon-comp">Load</button>
                                <button class="btn-small btn-danger-small" id="btn-delete-dungeon-comp">Delete</button>
                            </div>
                        </div>
                    </div>

                    <div class="control-section">
                        <button class="btn-play-dungeon" id="btn-play-dungeon-comp">Play This Dungeon</button>
                    </div>
                </div>

                <div class="control-section">
                    <div class="editor-message" id="editor-message"></div>
                </div>
            </div>
        </main>

        <footer>
            <p>Arrow keys to move | R to reset | Reach the green goal!</p>
        </footer>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
